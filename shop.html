<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Toko Antarbintang</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gradient-to-br from-gray-900 to-black text-white min-h-screen flex flex-col relative overflow-hidden">

  <div class="stars"></div>
  <div class="twinkling"></div>
  <div class="clouds"></div>

  <div class="meteor" style="left: 10%; animation-delay: 1s; animation-duration: 6s;"></div>
  <div class="meteor" style="left: 30%; animation-delay: 3s; animation-duration: 8s;"></div>
  <div class="meteor" style="left: 60%; animation-delay: 5s; animation-duration: 5s;"></div>
  <div class="meteor" style="left: 80%; animation-delay: 2s; animation-duration: 7s;"></div>
  <div class="meteor" style="left: 20%; animation-delay: 0.5s; animation-duration: 9s;"></div>
  <div class="meteor" style="left: 70%; animation-delay: 4s; animation-duration: 7s;"></div>

  <header class="relative z-10 p-4 border-b border-gray-700 flex items-center justify-between bg-gray-900/70 backdrop-blur-sm">
    <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">üåå Toko Antarbintang</h1>
    <div class="text-sm">
      Total: <span id="total">0</span> |
      <span class="text-green-400">Tersedia: <span id="tersedia">0</span></span> |
      <span class="text-red-400">Terjual: <span id="terjual">0</span></span>
    </div>
  </header>

  <main class="flex-1 p-4 relative z-10">
    <h2 class="text-xl font-semibold mb-3 text-blue-300">ü™ê Daftar Item Langka</h2>
    <input id="search" type="text" placeholder="Cari item di galaksi..."
      class="w-full mb-3 px-3 py-2 rounded-lg bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 border border-gray-600">
    <ul id="stokList" class="space-y-4 text-sm">
      <p class="text-gray-400">Belum ada item ditambahkan ke galaksi...</p>
    </ul>
  </main>

  <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <div class="relative bg-gray-900 p-4 rounded-lg max-w-3xl w-full mx-auto shadow-lg">
      <button id="closeModal" class="absolute top-2 right-2 text-white text-3xl font-bold">&times;</button>
      <div id="modalImageCarousel" class="relative">
        <img id="currentModalImage" src="" alt="Produk Image" class="w-full h-auto max-h-[70vh] object-contain rounded-md">
        <button id="prevImage" class="absolute left-0 top-1/2 -translate-y-1/2 bg-gray-700/70 hover:bg-gray-600/70 text-white p-3 rounded-full text-xl z-20">&lt;</button>
        <button id="nextImage" class="absolute right-0 top-1/2 -translate-y-1/2 bg-gray-700/70 hover:bg-gray-600/70 text-white p-3 rounded-full text-xl z-20">&gt;</button>
      </div>
      <div id="modalThumbnails" class="flex justify-center gap-2 mt-4 overflow-x-auto p-2 scrollbar-hide">
        </div>
    </div>
  </div>


  <script>
    let produk = JSON.parse(localStorage.getItem("produk")) || [];

    // Variabel untuk modal
    const imageModal = document.getElementById('imageModal');
    const closeModalBtn = document.getElementById('closeModal');
    const currentModalImage = document.getElementById('currentModalImage');
    const prevImageBtn = document.getElementById('prevImage');
    const nextImageBtn = document.getElementById('nextImage');
    const modalThumbnails = document.getElementById('modalThumbnails');
    let currentImages = [];
    let currentImageIndex = 0;

    // Fungsi untuk menampilkan modal
    function showImageModal(images, startIndex = 0) {
      currentImages = images;
      currentImageIndex = startIndex;
      updateModalImage();
      imageModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // Nonaktifkan scroll body
      renderModalThumbnails();
    }

    // Fungsi untuk memperbarui gambar di modal
    function updateModalImage() {
      if (currentImages.length > 0) {
        currentModalImage.src = currentImages[currentImageIndex];
      }
    }

    // Fungsi untuk merender thumbnail di modal
    function renderModalThumbnails() {
        modalThumbnails.innerHTML = '';
        currentImages.forEach((imgSrc, index) => {
            const thumb = document.createElement('img');
            thumb.src = imgSrc;
            thumb.className = `w-16 h-16 object-cover rounded-md cursor-pointer border-2 ${index === currentImageIndex ? 'border-blue-500' : 'border-transparent'} hover:border-blue-400 transition-all`;
            thumb.addEventListener('click', () => {
                currentImageIndex = index;
                updateModalImage();
                renderModalThumbnails(); // Perbarui border thumbnail aktif
            });
            modalThumbnails.appendChild(thumb);
        });
    }


    // Event listener untuk tombol Close modal
    closeModalBtn.addEventListener('click', () => {
      imageModal.classList.add('hidden');
      document.body.style.overflow = ''; // Aktifkan kembali scroll body
    });

    // Event listener untuk tombol Prev Image
    prevImageBtn.addEventListener('click', () => {
      currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
      updateModalImage();
      renderModalThumbnails();
    });

    // Event listener untuk tombol Next Image
    nextImageBtn.addEventListener('click', () => {
      currentImageIndex = (currentImageIndex + 1) % currentImages.length;
      updateModalImage();
      renderModalThumbnails();
    });


    function renderProduk() {
      const list = document.getElementById("stokList");
      list.innerHTML = "";

      if (produk.length === 0) {
        list.innerHTML = `<p class="text-gray-400">Belum ada produk...</p>`;
        return;
      }

      produk.forEach((p) => {
        const li = document.createElement("li");
        li.className = "p-4 bg-gray-800 rounded-lg flex justify-between items-center shadow-md border border-gray-700";
        li.innerHTML = `
          <div class="flex items-center gap-4">
            ${p.foto && p.foto.length > 0 ? `<img src="${p.foto[0]}" alt="${p.nama}" class="w-20 h-20 rounded-lg object-cover border border-blue-400 cursor-pointer product-thumbnail">` : ''}
            <div>
              <p class="font-bold text-lg text-blue-300">${p.nama}</p>
              <p class="text-md text-green-400">Rp ${p.harga}</p>
              <p class="text-sm text-gray-300 mt-1">${p.deskripsi}</p>
              <p class="text-xs text-purple-300 mt-1">Roblox ID: ${p.usernameRoblox || 'N/A'}</p>
              <p class="text-xs text-yellow-300 mt-1">Stok: ${p.stok}</p>
            </div>
          </div>
          <span class="px-3 py-1 rounded-full text-white ${p.stok === 0 ? 'bg-red-600' : 'bg-green-600'}">
            ${p.stok > 0 ? '<a href="form.html?produk='+encodeURIComponent(p.nama)+'&harga='+encodeURIComponent(p.harga)+'" class="underline font-semibold animated-btn">Beli Sekarang!</a>' : 'Terjual'}
          </span>
        `;
        list.appendChild(li);

        // Tambahkan event listener ke gambar thumbnail
        const thumbnail = li.querySelector('.product-thumbnail');
        if (thumbnail && p.foto && p.foto.length > 0) {
          thumbnail.addEventListener('click', () => {
            showImageModal(p.foto); // Tampilkan semua gambar produk ini
          });
        }
      });

      updateStats();
    }

    function updateStats() {
      document.getElementById("total").innerText = produk.length;
      document.getElementById("tersedia").innerText = produk.filter(p => p.stok > 0).length;
      document.getElementById("terjual").innerText = produk.filter(p => p.stok === 0).length;
    }

    document.getElementById("search").addEventListener("input", function() {
      const keyword = this.value.toLowerCase();
      const filtered = produk.filter(p => p.nama.toLowerCase().includes(keyword));
      const list = document.getElementById("stokList");
      list.innerHTML = "";

      if (filtered.length === 0) {
        list.innerHTML = `<p class="text-gray-400">Tidak ada hasil...</p>`;
        return;
      }

      filtered.forEach((p) => {
        const li = document.createElement("li");
        li.className = "p-4 bg-gray-800 rounded-lg flex justify-between items-center shadow-md border border-gray-700";
        li.innerHTML = `
          <div class="flex items-center gap-4">
            ${p.foto && p.foto.length > 0 ? `<img src="${p.foto[0]}" alt="${p.nama}" class="w-20 h-20 rounded-lg object-cover border border-blue-400 cursor-pointer product-thumbnail">` : ''}
            <div>
              <p class="font-bold text-lg text-blue-300">${p.nama}</p>
              <p class="text-md text-green-400">Rp ${p.harga}</p>
              <p class="text-sm text-gray-300 mt-1">${p.deskripsi}</p>
              <p class="text-xs text-purple-300 mt-1">Roblox ID: ${p.usernameRoblox || 'N/A'}</p>
              <p class="text-xs text-yellow-300 mt-1">Stok: ${p.stok}</p>
            </div>
          </div>
          <span class="px-3 py-1 rounded-full text-white ${p.stok === 0 ? 'bg-red-600' : 'bg-green-600'}">
            ${p.stok > 0 ? '<a href="form.html?produk='+encodeURIComponent(p.nama)+'&harga='+encodeURIComponent(p.harga)+'" class="underline font-semibold animated-btn">Beli Sekarang!</a>' : 'Terjual'}
          </span>
        `;
        list.appendChild(li);

        // Tambahkan event listener ke gambar thumbnail hasil pencarian
        const thumbnail = li.querySelector('.product-thumbnail');
        if (thumbnail && p.foto && p.foto.length > 0) {
          thumbnail.addEventListener('click', () => {
            showImageModal(p.foto); // Tampilkan semua gambar produk ini
          });
        }
      });

      updateStats();
    });

    renderProduk();
  </script>

<script>
  fetch("http://localhost:3000/api/status")
    .then(res => res.json())
    .then(data => {
      console.log(data); // Cek di console browser
      document.body.innerHTML += `<p>${data.status}</p>`;
    })
    .catch(err => console.error("Error:", err));
</script>

</body>

</html>
